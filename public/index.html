<!DOCTYPE html>
<html lang=en>

<head>
    <meta charset="UTF-8">
    <!--script type="module" src="three.module.js"></script>
    <script src="shapes.js"></script>
    <script src="render.js"></script>
    <script src="main.js"></script-->
    <title>Title</title>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script type="module">
        import * as THREE from './three.module.js';

        function main() {
            const canvas = document.querySelector('#canvas');
            const renderer = new THREE.WebGLRenderer({ canvas });

            const fov = 75;
            const aspect = 2;  // canvas default = 2 = 300/150
            const near = 0.1;
            const far = 5;
            const camera = new THREE.PerspectiveCamera
                (fov, aspect, near, far);

            camera.position.z = 3;
            const scene = new THREE.Scene();
            const boxWidth = 1;
            const boxHeight = 1;
            const boxDepth = 1;
            const geometry = new THREE.BoxGeometry
                (boxWidth, boxHeight, boxDepth);
            const coneRad = 0.5;
            const coneHeight = 1;
            const coneGeo = new THREE.ConeGeometry(coneRad, coneHeight);

            function render(time) {
                time *= 0.001;  // convert time to seconds
                shapes.forEach((cube, ndx) => {
                    const speed = 1 + ndx * .1;
                    const rot = time * speed;
                    cube.rotation.x = rot;
                    cube.rotation.y = rot;
                })
                bullets.forEach((bullet, ndx) => {
                    bullet.position.x -= Math.sin(bullet.rotation.y + Math.PI / 2) * 0.1;
                    bullet.position.z -= Math.cos(bullet.rotation.y + Math.PI / 2) * 0.1;
                })
                renderer.render(scene, camera);
                requestAnimationFrame(render);
            }

            const color = 0xFFFFFF;
            const intensity = 1;
            const light = new THREE.DirectionalLight(color, intensity);
            light.position.set(-1, 2, 4);
            scene.add(light);


            function makeInstance(geometry, color, x) {
                const material = new THREE.MeshBasicMaterial({ color });

                const cube = new THREE.Mesh(geometry, material);
                scene.add(cube);

                cube.position.x = x;

                return cube;
            }
            function makeBullet() {
                const bullet = makeInstance(coneGeo, 0xff0000, 0);
                
                bullet.rotation.z = -Math.PI / 2;
                bullet.rotation.y = camera.rotation.y - Math.PI / 2 ;
                bullet.position.z = camera.position.z;

                return bullet;
            }
            const shapes = [
                makeInstance(geometry, 0x44aa88, 0),
                makeInstance(geometry, 0x8844aa, -2),
                //makeInstance(geometry, 0xaa8844, 2),
                makeInstance(coneGeo, 0xff00000, 2)
            ];

            const bullets = [];

            document.addEventListener(
                "keydown",
                function (event) {
                    if (event.keyCode == 65 || event.keyCode == 37) {
                        camera.rotation.y += 0.1;
                    } else if (event.keyCode == 68 || event.keyCode == 39) {
                        camera.rotation.y -= 0.1;
                    }
                }, false
            )

            document.addEventListener(
                "mousedown",
                function (event) {
                    bullets.push(makeBullet())
                }, false
            )

            requestAnimationFrame(render);
        }
        main();
    </script>
</body>

</html>
